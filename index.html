<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Math Master</title>

<!-- Google Font -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#0f172a;       /* deep navy */
    --bg2:#12335f;       /* blue gradient mid */
    --accent:#3da5ff;    /* bright blue */
    --card:#0b2540;
    --muted:#94a3b8;
    --success:#16a34a;
    --danger:#ef4444;
  }

  html,body{height:100%;margin:0;font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  body{
    background: radial-gradient(1200px 600px at 10% 10%, rgba(62,131,255,0.12), transparent),
                linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#e6f0ff;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
    box-sizing:border-box;
  }

  /* App container */
  .app {
    width:100%;
    max-width:1000px;
    min-height:640px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px;
    box-shadow:0 20px 50px rgba(2,6,23,0.6);
    padding:24px;
    box-sizing:border-box;
    position:relative;
    overflow:hidden;
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:18px;
  }

  h1{
    margin:0;
    font-size:1.6rem;
    letter-spacing:0.4px;
    display:flex;
    align-items:center;
    gap:12px;
  }
  .logo-badge{
    width:46px;height:46px;border-radius:10px;
    background:linear-gradient(135deg,var(--accent),#0ea5e9);
    display:flex;align-items:center;justify-content:center;font-weight:700;color:#001;
    box-shadow:0 6px 18px rgba(61,165,255,0.18);
    font-size:1.1rem;
  }

  .subtitle{color:var(--muted); font-size:0.95rem;}

  /* volume control small in header */
  .header-right{display:flex;align-items:center;gap:12px;}
  .volume {
    display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.02);padding:6px 10px;border-radius:8px;
    border:1px solid rgba(255,255,255,0.03);
  }
  .volume input[type=range]{width:120px;}

  /* Main grid for menu + screens */
  .screen {
    margin-top:8px;
  }

  /* Main menu 3-grid layout */
  .menu-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    gap:18px;
  }

  .learn-card{
    grid-column: 1 / -1;  /* full width */
    min-height:220px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:18px;
    box-shadow:0 8px 20px rgba(2,6,23,0.5);
    border:1px solid rgba(255,255,255,0.03);
    display:flex;
    gap:16px;
    align-items:center;
    justify-content:space-between;
  }

  .learn-left{flex:1}
  .learn-right{width:260px;display:flex;flex-direction:column;gap:10px;align-items:center}

  .card-title{font-weight:600;font-size:1.05rem;}
  .card-desc{color:var(--muted);font-size:0.95rem;margin-top:6px;}

  .mode-card{
    background:linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
    border-radius:12px;padding:18px;text-align:center;border:1px solid rgba(255,255,255,0.03);
    min-height:160px;display:flex;flex-direction:column;justify-content:center;gap:12px;
    box-shadow:0 8px 18px rgba(2,6,23,0.45);
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .mode-card:hover{transform:translateY(-6px);box-shadow:0 22px 40px rgba(2,6,23,0.6);}

  .mode-emoji{font-size:2.5rem;}
  .mode-label{font-weight:600}

  .btn{
    background:linear-gradient(180deg,var(--accent),#0b8fe7);
    color:#012034;padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;
    box-shadow:0 8px 18px rgba(61,165,255,0.14);
  }
  .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:#dff0ff;font-weight:600;}

  /* screens */
  .game-screen, .learn-screen, .end-screen { display:none; padding-top:8px; }
  .active { display:block; }

  /* Learn table */
  .table-wrap{width:100%;overflow:auto;padding:6px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:10px}
  table.times{border-collapse:collapse;width:100%;min-width:760px}
  table.times th, table.times td{border:1px solid rgba(255,255,255,0.03);padding:10px;text-align:center;background:linear-gradient(180deg, rgba(0,0,0,0.02), transparent);color:#0b2540}
  table.times td.cell { background:#ffffff; color:#0b2540; font-weight:600; cursor:pointer; }
  table.times th.header{background:#ffffffcc;color:#0b2540;font-weight:700}

  /* Game HUD */
  .hud{display:flex;gap:12px;align-items:center;margin-bottom:18px;flex-wrap:wrap}
  .hud .box{background:rgba(255,255,255,0.02);padding:10px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)}
  .score{font-weight:700;font-size:1.1rem}
  .lives{font-size:1.1rem}
  .timer{font-weight:700;color:var(--accent)}

  /* question area */
  .question { font-size:2.6rem;font-weight:700;text-align:center;margin:18px 0;display:flex;align-items:center;gap:14px; justify-content:center}
  .choices{display:grid;grid-template-columns:1fr 1fr;gap:12px;max-width:720px;margin:0 auto}
  .choice-btn{
    padding:14px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);color:#e6f0ff;font-size:1.05rem;font-weight:700;cursor:pointer;
    transition:transform .12s ease, box-shadow .12s ease, background .12s ease;
  }
  .choice-btn:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(2,6,23,0.45);}
  .choice-btn.correct{background:linear-gradient(90deg,#22c55e,#16a34a);color:#04210b;}
  .choice-btn.incorrect{background:linear-gradient(90deg,#ff7b7b,#ef4444);color:#2b0202;}

  .feedback{height:28px;text-align:center;margin-top:8px;color:var(--muted)}

  /* end screen */
  .end-screen .bigscore{font-size:3.8rem;font-weight:800;color:var(--accent);text-align:center;margin:8px 0}
  .controls{display:flex;gap:12px;justify-content:center;margin-top:16px}

  /* responsive */
  @media (max-width:820px){
    .table-wrap{min-width:0}
    .learn-right{display:none}
    .menu-grid{grid-template-columns:1fr}
    .learn-card{flex-direction:column;gap:12px}
    .question{font-size:2.2rem}
    .choices{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Math Master">
    <header>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="logo-badge">MM</div>
        <div>
          <h1>Math Master</h1>
          <div class="subtitle">Practice Multiplication & Division ‚Äî Learn ‚Ä¢ Survival ‚Ä¢ Time Attack</div>
        </div>
      </div>

      <div class="header-right">
        <div class="volume" title="Volume">
          <label style="font-size:0.9rem;color:var(--muted)">üîä</label>
          <input id="volumeSlider" type="range" min="0" max="100" value="70">
        </div>
        <button id="btn-home" class="btn secondary" title="Back to Menu">Home</button>
      </div>
    </header>

    <!-- Main content -->
    <main class="screen">
      <!-- Menu -->
      <section id="main-menu" class="menu active">
        <div class="menu-grid">
          <div class="learn-card">
            <div class="learn-left">
              <div class="card-title">üìò Learn Multiplication</div>
              <div class="card-desc">Interactive multiplication table (1‚Äì12). Click a product to highlight the row and column and see the equation.</div>
              <div style="margin-top:12px"><button id="open-learn" class="btn">Open Learn Mode</button></div>
            </div>
            <div class="learn-right">
              <div style="font-weight:700;color:var(--muted)">Quick Preview</div>
              <div style="display:flex;gap:8px;align-items:center;justify-content:center">
                <div style="background:#06213a;padding:8px 10px;border-radius:8px;text-align:center">
                  <div style="font-size:1.4rem">4 √ó 6</div>
                  <div style="color:var(--muted)">= 24</div>
                </div>
              </div>
              <div style="margin-top:8px">
                <small style="color:var(--muted)">Try Learn for step-by-step practice</small>
              </div>
            </div>
          </div>

          <div id="card-life" class="mode-card" role="button" tabindex="0" aria-label="Life Mode">
            <div class="mode-emoji">‚ù§Ô∏è</div>
            <div class="mode-label">Life Mode</div>
            <div class="card-desc" style="color:var(--muted)">3 lives. Multiplication & Division mix. Wrong loses life.</div>
            <div><button class="btn" data-mode="life">Play Life</button></div>
          </div>

          <div id="card-time" class="mode-card" role="button" tabindex="0" aria-label="Time Mode">
            <div class="mode-emoji">‚è±Ô∏è</div>
            <div class="mode-label">Time Mode</div>
            <div class="card-desc" style="color:var(--muted)">60 seconds. Keep answering until time runs out.</div>
            <div><button class="btn" data-mode="time">Play Time</button></div>
          </div>
        </div>
      </section>

      <!-- Learn screen -->
      <section id="learn-screen" class="learn-screen">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px">
          <div>
            <div style="font-weight:700;font-size:1.1rem">Learn Mode ‚Äî Multiplication Table (1‚Äì12)</div>
            <div style="color:var(--muted);margin-top:6px">Tap any cell to highlight row and column and show the equation.</div>
          </div>
          <div>
            <button id="learn-back" class="btn secondary">Back</button>
          </div>
        </div>
        <div class="table-wrap" id="table-wrap"></div>
        <div style="margin-top:12px;color:var(--muted)">Tip: use this table to memorize products and patterns.</div>
      </section>

      <!-- Game screen (shared logic for life/time) -->
      <section id="game-screen" class="game-screen">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap">
          <div class="hud">
            <div class="box hud-mode"><span id="hudLabel">Mode</span></div>
            <div class="box lives" id="hudLives">Lives: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            <div class="box timer" id="hudTimer">Time: 60</div>
            <div class="box score" id="hudScore">Score: 0</div>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <button id="btn-quit" class="btn secondary">Quit</button>
          </div>
        </div>

        <div class="question" id="questionArea">5 √ó 7</div>

        <div class="choices" id="choicesArea">
          <!-- choice buttons inserted here -->
        </div>

        <div class="feedback" id="feedbackText"></div>
      </section>

      <!-- End screen -->
      <section id="end-screen" class="end-screen">
        <div style="text-align:center">
          <div style="font-weight:700;font-size:1.1rem" id="endTitle">Game Over</div>
          <div class="bigscore" id="endScore">0</div>
          <div style="color:var(--muted);margin-top:6px">Thanks for playing Math Master!</div>
          <div class="controls">
            <button id="play-again" class="btn">Play Again</button>
            <button id="back-menu" class="btn secondary">Main Menu</button>
          </div>
        </div>
      </section>
    </main>
  </div>

<script>
/* ---------------------------
   Math Master - Single File App
   - Learn (1-12 table)
   - Life Mode (3 lives)
   - Time Mode (60s)
   - Multiplication & Division questions
   - Non-repeating questions per session
   - Visual green/red feedback
   - Sound effects via WebAudio
----------------------------*/

/* --------- Utilities --------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

/* --------- DOM refs --------- */
const mainMenu = $('#main-menu');
const learnScreen = $('#learn-screen');
const gameScreen = $('#game-screen');
const endScreen = $('#end-screen');

const tableWrap = $('#table-wrap');
const openLearnBtn = $('#open-learn');
const learnBackBtn = $('#learn-back');
const btnHome = $('#btn-home');

const hudLabel = $('#hudLabel');
const hudLives = $('#hudLives');
const hudTimer = $('#hudTimer');
const hudScore = $('#hudScore');
const questionArea = $('#questionArea');
const choicesArea = $('#choicesArea');
const feedbackText = $('#feedbackText');
const btnQuit = $('#btn-quit');

const endTitle = $('#endTitle');
const endScore = $('#endScore');
const playAgainBtn = $('#play-again');
const backMenuBtn = $('#back-menu');

const volumeSlider = $('#volumeSlider');

let mode = null; // 'life' or 'time'
let score = 0;
let lives = 3;
let timer = 60;
let timerInterval = null;
let questionTimeout = null;

/* Question pool to avoid repeat */
let remainingQuestions = []; // array of question objects {type:'mul'|'div', a,b,answer}

/* WebAudio setup for sounds (no external files) */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const masterGain = audioCtx.createGain();
masterGain.gain.value = 0.7;
masterGain.connect(audioCtx.destination);

volumeSlider.addEventListener('input', ()=> {
  masterGain.gain.value = parseInt(volumeSlider.value)/100;
});

/* Simple synthesized sounds */
function playTone({freq=440, type='sine', duration=0.15, volume=0.6, when=0}={}){
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type;
  o.frequency.value = freq;
  g.gain.value = volume;
  o.connect(g);
  g.connect(masterGain);
  const start = audioCtx.currentTime + when;
  o.start(start);
  g.gain.exponentialRampToValueAtTime(0.0001, start + duration);
  o.stop(start + duration + 0.02);
}

/* Composite SFX */
function sfxCorrect(){ // pleasant ascending tones
  playTone({freq:720, type:'sine', duration:0.10, volume:0.5});
  playTone({freq:880, type:'sine', duration:0.12, volume:0.45, when:0.09});
}
function sfxWrong(){ // short buzzer
  playTone({freq:260, type:'sawtooth', duration:0.22, volume:0.6});
}
function sfxLose(){ // descending minor
  playTone({freq:200, type:'sine', duration:0.22, volume:0.6});
  playTone({freq:140, type:'sine', duration:0.28, volume:0.45, when:0.18});
}
function sfxWin(){ // short celebratory arpeggio
  playTone({freq:800, type:'triangle', duration:0.12, volume:0.6});
  playTone({freq:1000, type:'triangle', duration:0.12, volume:0.55, when:0.11});
  playTone({freq:1200, type:'triangle', duration:0.12, volume:0.5, when:0.22});
}

/* Resume audio context on first user interaction to avoid autoplay blocking */
function ensureAudioContext(){
  if (audioCtx.state === 'suspended'){
    audioCtx.resume();
  }
}

/* ---------- UI helpers ---------- */
function showScreen(screen){
  [mainMenu, learnScreen, gameScreen, endScreen].forEach(s => s.classList.remove('active'));
  screen.classList.add('active');
}

/* ---------- Learn Mode (1‚Äì12 table) ---------- */
function buildLearnTable(){
  // create table 13x13 with headers 0..12
  const max = 12;
  let tbl = document.createElement('table');
  tbl.className = 'times';
  // header row
  let thead = document.createElement('thead');
  let hr = document.createElement('tr');
  hr.appendChild(tdHeader('√ó'));
  for(let j=1;j<=max;j++) hr.appendChild(tdHeader(j));
  thead.appendChild(hr); tbl.appendChild(thead);
  // body
  let tbody = document.createElement('tbody');
  for(let i=1;i<=max;i++){
    let r = document.createElement('tr');
    r.appendChild(tdHeader(i));
    for(let j=1;j<=max;j++){
      let cell = document.createElement('td');
      cell.className = 'cell';
      cell.textContent = i*j;
      cell.dataset.i = i;
      cell.dataset.j = j;
      cell.addEventListener('click', ()=> {
        highlightTableCell(i,j);
      });
      r.appendChild(cell);
    }
    tbody.appendChild(r);
  }
  tbl.appendChild(tbody);
  tableWrap.innerHTML = '';
  tableWrap.appendChild(tbl);
}

function tdHeader(txt){
  let th = document.createElement('th');
  th.className = 'header';
  th.textContent = txt;
  return th;
}

function highlightTableCell(i,j){
  // highlight row and column visually; show popup below
  ensureAudioContext();
  // clear previous highlights
  document.querySelectorAll('table.times td').forEach(c=>c.style.outline='');
  document.querySelectorAll('table.times tr').forEach(row=>{
    const cells = Array.from(row.querySelectorAll('td'));
    cells.forEach(cell=>{
      if (parseInt(cell.dataset.i)===i || parseInt(cell.dataset.j)===j){
        cell.style.outline = '3px solid rgba(61,165,255,0.25)';
      } else {
        cell.style.outline = '';
      }
    });
  });
  // show small message
  feedbackText.style.color = '#cde9ff';
  feedbackText.textContent = `${i} √ó ${j} = ${i*j}`;
  sfxCorrect();
  clearTimeout(questionTimeout);
  questionTimeout = setTimeout(()=>{ feedbackText.textContent=''; }, 2500);
}

/* ---------- Question generation & session pool ---------- */
function buildQuestionPool(){
  // pool of multiplication and division questions using operands 1..12
  const max = 12;
  const pool = [];
  // multiplication: type 'mul'
  for(let a=1;a<=max;a++){
    for(let b=1;b<=max;b++){
      pool.push({type:'mul', a:a, b:b, answer: a*b});
    }
  }
  // division: type 'div' where dividend = a*b, divisor = b, answer = a (i.e., reversed)
  for(let a=1;a<=max;a++){
    for(let b=1;b<=max;b++){
      pool.push({type:'div', a: a*b, b: b, answer: a}); // a*b √∑ b = a
    }
  }
  return shuffle(pool);
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

/* ---------- Game logic ---------- */
function startGame(newMode){
  ensureAudioContext();
  mode = newMode; // 'life' or 'time'
  score = 0;
  lives = 3;
  timer = 60;
  remainingQuestions = buildQuestionPool(); // fresh pool
  hudScore.textContent = `Score: ${score}`;
  hudLives.textContent = `Lives: ${'‚ù§Ô∏è'.repeat(lives)}${'üñ§'.repeat(3-lives)}`;
  hudTimer.textContent = `Time: ${timer}`;
  hudLabel.textContent = mode === 'life' ? "Life Mode" : "Time Mode";
  feedbackText.textContent = '';
  showScreen(gameScreen);

  // show/hide relevant HUD elements
  if (mode === 'life'){
    hudLives.style.display = 'inline-block';
    hudTimer.style.display = 'none';
  } else {
    hudTimer.style.display = 'inline-block';
    hudLives.style.display = 'none';
    startTimer();
  }

  nextQuestion();
}

function startTimer(){
  clearInterval(timerInterval);
  timerInterval = setInterval(()=>{
    timer--;
    hudTimer.textContent = `Time: ${timer}`;
    if (timer <= 0){
      clearInterval(timerInterval);
      endGame();
    }
  }, 1000);
}

function stopTimer(){
  clearInterval(timerInterval);
}

/* Pick next question (non repeating) */
function nextQuestion(){
  clearTimeout(questionTimeout);
  feedbackText.textContent = '';
  // if pool empty -> refill
  if (remainingQuestions.length === 0){
    remainingQuestions = buildQuestionPool();
  }
  // choose next random item from remainingQuestions
  const q = remainingQuestions.pop();
  currentQuestion = q;
  renderQuestion(q);
}

/* Render question and choices */
let currentQuestion = null;
function renderQuestion(q){
  // q: {type:'mul'|'div', a,b,answer}
  if (q.type === 'mul'){
    questionArea.textContent = `${q.a} √ó ${q.b}`;
  } else {
    questionArea.textContent = `${q.a} √∑ ${q.b}`;
  }
  // Generate 4 choices including correct answer
  const correct = q.answer;
  const choices = new Set();
  choices.add(correct);
  while (choices.size < 4){
    // generate plausible distractors: +/- small random
    let delta = Math.floor(Math.random()*10) - 4;
    if (delta === 0) delta = 3;
    let candidate = Math.max(1, correct + delta);
    // for division answers, keep candidate reasonable
    if (q.type === 'div') candidate = Math.max(1, candidate);
    choi
